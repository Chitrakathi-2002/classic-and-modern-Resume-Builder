<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Resume Builder - With Edit, Templates & Photo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #eef2f5;
    margin: 0;
    padding: 0;
  }
  header {
    background: #2c3e50;
    color: white;
    text-align: center;
    padding: 1rem 0;
    user-select: none;
  }
  main {
    display: flex;
    gap: 2rem;
    padding: 2rem;
    max-width: 1300px;
    margin: auto;
    flex-wrap: wrap;
  }
  
  .form-section, .preview-section {
    flex: 1 1 500px;
    background: #fff;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    min-width: 320px;
    max-height: 80vh;
    overflow-y: auto;
  }
  h2 {
    margin-top: 0;
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 0.3rem;
    margin-bottom: 1rem;
  }
  label {
    display: block;
    margin-top: 1rem;
    font-weight: bold;
  }
  select, button, input, textarea {
    width: 100%;
    margin-top: 0.5rem;
    padding: 0.8rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    cursor: pointer;
    box-sizing: border-box;
  }
  input, textarea {
    cursor: text;
  }
  button:hover:not(:disabled) {
    background: #2c80b4;
    color: white;
  }
  button:disabled {
    background: #aaa;
    cursor: not-allowed;
    color: #eee;
  }
  #formatToolbar {
    display: flex;
    gap: 10px;
    margin-top: 1rem;
    flex-wrap: wrap;
  }
  #formatToolbar button {
    width: auto;
    padding: 0.4rem 0.8rem;
    font-weight: bold;
    border-radius: 4px;
    border: 1px solid #3498db;
    background: white;
    color: #3498db;
    transition: background-color 0.3s, color 0.3s;
  }
  #formatToolbar button:hover {
    background-color: #3498db;
    color: white;
  }
  #entryContent {
    margin-top: 0.5rem;
    width: 100%;
    min-height: 100px;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 8px;
    outline: none;
    background: white;
    font-size: 1rem;
    line-height: 1.3;
    overflow-y: auto;
    max-height: 150px;
  }
  .entry-list {
    margin-top: 1rem;
  }
  .entry {
    background: #f9f9f9;
    padding: 0.7rem 1rem;
    border-radius: 6px;
    margin-bottom: 0.8rem;
    position: relative;
    border-left: 4px solid #3498db;
    white-space: pre-wrap;
    cursor: default;
  }
  .entry-buttons {
    position: absolute;
    top: 0.3rem;
    right: 0.5rem;
    display: flex;
    gap: 0.3rem;
  }
  .entry-buttons button {
    background: transparent;
    color: #3498db;
    font-size: 1.1rem;
    padding: 0 6px;
    border: none;
    cursor: pointer;
    user-select: none;
  }
  .entry-buttons button:hover {
    color: #2c80b4;
  }
  .preview-section {
    overflow-y: auto;
    background: #fff;
    border: 1px solid #ddd;
    position: relative;
  }
  .resume-preview h3 {
    margin-bottom: 0.3rem;
    color: #2980b9;
    border-bottom: 2px solid #2980b9;
    padding-bottom: 3px;
    margin-top: 1.5rem;
  }
  .resume-preview .section {
    margin-bottom: 1.5rem;
  }
  .resume-preview .entry-content {
    margin-bottom: 0.7rem;
    font-size: 0.85rem;
    line-height: 1.3;
  }
  #clearAllBtn, #exportWordBtn, #exportPdfBtn {
    margin-top: 1rem;
    width: 30%;
    display: inline-block;
    margin-right: 1%;
    border: none;
    font-weight: bold;
    border-radius: 6px;
    padding: 10px 0;
    user-select: none;
  }
  #clearAllBtn { background: #e74c3c; }
  #exportWordBtn { background: #2c80b4; color: white; }
  #exportPdfBtn { background: #27ae60; color: white; }
  #clearAllBtn:hover { background: #c0392b; }
  #exportWordBtn:hover { background: #1a5d8f; }
  #exportPdfBtn:hover { background: #1e8449; }
  .preview-section::-webkit-scrollbar {
    width: 8px;
  }
  .preview-section::-webkit-scrollbar-thumb {
    background-color: #3498db;
    border-radius: 10px;
  }
  .resume-preview .resume-heading {
    font-size: 2.2rem;
    margin: 0;
    font-weight: bold;
  }
  .resume-preview .resume-subheading {
    font-size: 1.3rem;
    color: #555;
    margin: 0;
  }
  .resume-preview .resume-contact {
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.3rem;
    margin-bottom: 1.5rem;
    white-space: pre-wrap;
  }
  /* Templates styles */
  .template-default {
    font-family: Arial, sans-serif;
    color: #333;
  }
  .template-modern {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #2c3e50;
  }
  .template-modern h3 {
    color: #27ae60;
    border-color: #27ae60;
  }
  .template-classic {
    font-family: 'Times New Roman', Times, serif;
    color: #222;
  }
  .template-classic h3 {
    color: #8b0000;
    border-color: #8b0000;
    font-style: italic;
  }
  /* Profile photo */
  #profilePhotoPreview {
    max-width: 120px;
    max-height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 2px solid #3498db;
    cursor: grab;
    position: absolute;
    top: 20px;
    right: 20px;
  }
  .resume-photo-container {
    position: relative;
    min-height: 130px;
  }
  /* Template switcher styling */
  #templateSelect {
    margin-top: 0.3rem;
    cursor: pointer;
  }
  /* PDF export options */
  #pdfOptions {
    margin-top: 1rem;
  }
  #pdfOptions label {
    font-weight: normal;
    margin-right: 10px;
    cursor: pointer;
  }
  /* Pencil icon for edit */
  .edit-icon::before {
    content: "\270E"; /* Pencil unicode */
    font-weight: bold;
  }
</style>
</head>
<body>

<header><h1>Resume Builder with Advanced Features</h1></header>

<main>
  <div class="form-section">
    <h2>Personal Info & Resume Sections</h2>
    <label>Name:</label><input id="userNameInput" type="text" placeholder="Your full name" spellcheck="false"/>
    <label>Destination / Job Title:</label><input id="destinationInput" type="text" placeholder="Your target job title" spellcheck="false"/>
    <label>Contact Details:</label>
    <textarea id="contactDetails" placeholder="Phone, email, LinkedIn…" rows="3" spellcheck="false"></textarea>

    <label>Upload Profile Photo:</label>
    <input type="file" id="profilePhotoInput" accept="image/*" />

    <hr/>
    <label>Select Section or Custom Heading:</label>
    <div style="display:flex;gap:10px;">
      <select id="sectionSelect" style="flex:1; cursor:pointer;">
        <option value="Summary">Summary</option>
        <option value="Education">Education</option>
        <option value="Experience">Experience</option>
        <option value="Skills">Skills</option>
        <option value="Projects">Projects</option>
        <option value="Certifications">Certifications</option>
      </select>
      <input id="customSectionInput" type="text" placeholder="Or custom heading…" style="flex:1; cursor:text;" spellcheck="false"/>
    </div>
    <label>Entry Content:</label>
    <div id="entryContent" contenteditable="true" style="min-height:100px;"></div>
    <div id="formatToolbar">
      <button onclick="formatText('bold')" title="Bold (Ctrl+B)"><b>B</b></button>
      <button onclick="formatText('italic')" title="Italic (Ctrl+I)"><i>I</i></button>
      <button onclick="formatText('underline')" title="Underline (Ctrl+U)"><u>U</u></button>
      <button onclick="changeFontSize('increase')" title="Increase Font Size">A+</button>
      <button onclick="changeFontSize('decrease')" title="Decrease Font Size">A-</button>
      <button onclick="clearFormatting()" title="Clear Formatting">Clear</button>
      <button onclick="undo()" title="Undo (Ctrl+Z)">↺ Undo</button>
      <button onclick="redo()" title="Redo (Ctrl+Y)">↻ Redo</button>
    </div>
    <button id="saveBtn" onclick="saveEntry()">Add Entry</button>
    <div class="entry-list" id="entryList"></div>
    <button id="clearAllBtn" onclick="clearAllData()">Clear All Data</button>

    <hr/>
    <label>Choose Resume Template:</label>
    <select id="templateSelect">
      <option value="template-default">Default</option>
      <option value="template-modern">Modern</option>
      <option value="template-classic">Classic</option>
    </select>

    <div id="pdfOptions">
      <h3>PDF Export Options</h3>
      <label>
        Page Size:
        <select id="pdfPageSize">
          <option value="a4">A4 (210×297 mm)</option>
          <option value="letter">Letter (8.5×11 in)</option>
        </select>
      </label>
      <label>
        Margin (mm):
        <input type="number" id="pdfMargin" value="20" min="5" max="50" style="width:60px;" />
      </label>
    </div>
    <button id="exportWordBtn" onclick="exportToWord()">Save as Word</button>
    <button id="exportPdfBtn" onclick="exportToPDF()">Save as PDF</button>
  </div>

  <div class="preview-section">
    <h2>Live Resume Preview</h2>
    <div class="resume-photo-container" id="photoContainer" style="position:relative;">
      <!-- Profile photo preview inserted here -->
    </div>
    <div class="resume-preview template-default" id="resumePreview" style="position: relative; min-height: 600px;">
      <p><em>Add data to see preview...</em></p>
    </div>
  </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.0/html-docx.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
  // Globals
  let resumeData = {}; // { sectionName: [{content: html}, ...] }
  let userInfo = { name:'', destination:'', contactDetails:'' };
  let editIndex = null; // {section, idx} or null for new
  let undoStack = [], redoStack = [];

  // Elements
  const sectionSelect = document.getElementById('sectionSelect'),
        customSectionInput = document.getElementById('customSectionInput'),
        entryContent = document.getElementById('entryContent'),
        entryList = document.getElementById('entryList'),
        saveBtn = document.getElementById('saveBtn'),
        userNameInput = document.getElementById('userNameInput'),
        destinationInput = document.getElementById('destinationInput'),
        contactDetailsInput = document.getElementById('contactDetails'),
        resumePreview = document.getElementById('resumePreview'),
        templateSelect = document.getElementById('templateSelect'),
        profilePhotoInput = document.getElementById('profilePhotoInput'),
        photoContainer = document.getElementById('photoContainer'),
        pdfPageSize = document.getElementById('pdfPageSize'),
        pdfMargin = document.getElementById('pdfMargin');

  let profilePhotoDataURL = null;
  let profilePhotoElement = null;
  let photoPosition = { top: 20, right: 20 };
  let isDraggingPhoto = false;
  let dragOffset = { x: 0, y: 0 };

  // Initialize
  loadFromLocalStorage();
  renderEntryList();
  updatePreview();
  attachEventListeners();

  // Format text commands
  function formatText(cmd) {
    document.execCommand(cmd, false, null);
    saveToUndoStack();
  }
  function changeFontSize(action) {
    let selection = window.getSelection();
    if (!selection.rangeCount) return;
    let span = document.createElement('span');
    let currentSize = window.getComputedStyle(selection.anchorNode.parentNode).fontSize;
    let sizeNum = parseInt(currentSize);
    if (action === 'increase') sizeNum += 2;
    else if (action === 'decrease' && sizeNum > 8) sizeNum -= 2;
    span.style.fontSize = sizeNum + 'px';
    document.execCommand('fontSize', false, '7'); // temporary biggest
    let fontElements = entryContent.querySelectorAll('font[size="7"]');
    fontElements.forEach(el => {
      el.removeAttribute('size');
      el.style.fontSize = span.style.fontSize;
    });
    saveToUndoStack();
  }
  function clearFormatting() {
    document.execCommand('removeFormat', false, null);
    saveToUndoStack();
  }

  // Undo/Redo history
  function saveToUndoStack() {
    undoStack.push(entryContent.innerHTML);
    if (undoStack.length > 50) undoStack.shift();
    redoStack = [];
  }
  function undo() {
    if (undoStack.length) {
      redoStack.push(entryContent.innerHTML);
      entryContent.innerHTML = undoStack.pop();
    }
  }
  function redo() {
    if (redoStack.length) {
      undoStack.push(entryContent.innerHTML);
      entryContent.innerHTML = redoStack.pop();
    }
  }

  // Save entry (add or update)
  function saveEntry() {
    let section = customSectionInput.value.trim() || sectionSelect.value;
    let content = entryContent.innerHTML.trim();
    if (!section) {
      alert('Please select or enter a section heading');
      return;
    }
    if (!content || content === '<br>') {
      alert('Please enter content for the entry');
      return;
    }
    if (!resumeData[section]) resumeData[section] = [];

    if (editIndex) {
      // Update existing
      resumeData[editIndex.section][editIndex.idx] = { content };
      editIndex = null;
      saveBtn.textContent = 'Add Entry';
    } else {
      // Add new
      resumeData[section].push({ content });
    }
    clearEntryForm();
    saveToLocalStorage();
    renderEntryList();
    updatePreview();
  }
if(resumeData.photoDataUrl){
  let photoEl = previewClone.querySelector('img');
  if(!photoEl){
    photoEl = document.createElement('img');
    previewClone.insertBefore(photoEl, previewClone.firstChild);
  }
  photoEl.src = resumeData.photoDataUrl;
  photoEl.style.width = '100px';
  photoEl.style.height = '100px';
  photoEl.style.objectFit = 'cover';
  photoEl.style.borderRadius = '50%';
  photoEl.style.position = 'absolute';
  photoEl.style.left = profilePhotoPreview.style.left || '20px';
  photoEl.style.top = profilePhotoPreview.style.top || '20px';
  photoEl.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
}

  // Clear entry form
  function clearEntryForm() {
    entryContent.innerHTML = '';
    customSectionInput.value = '';
    sectionSelect.selectedIndex = 0;
    undoStack = [];
    redoStack = [];
  }

  // Render entries list with edit icons
  function renderEntryList() {
    entryList.innerHTML = '';
    for (const [section, entries] of Object.entries(resumeData)) {
      entries.forEach((entry, idx) => {
        const entryDiv = document.createElement('div');
        entryDiv.className = 'entry';
        entryDiv.innerHTML = `<strong>${section}:</strong> <div>${entry.content}</div>`;
        const btnContainer = document.createElement('div');
        btnContainer.className = 'entry-buttons';
        const editBtn = document.createElement('button');
        editBtn.title = 'Edit entry';
        editBtn.innerHTML = '✏️'; // Pencil icon
        editBtn.onclick = () => editEntry(section, idx);
        btnContainer.appendChild(editBtn);
        entryDiv.appendChild(btnContainer);
        entryList.appendChild(entryDiv);
      });
    }
  }

  // Edit an entry: load into editor and set editIndex
  function editEntry(section, idx) {
    editIndex = { section, idx };
    const entry = resumeData[section][idx];
    customSectionInput.value = section;
    sectionSelect.value = section in Array.from(sectionSelect.options).map(o => o.value) ? section : sectionSelect.value;
    entryContent.innerHTML = entry.content;
    saveBtn.textContent = 'Update Entry';
    updatePreview();
    saveToUndoStack();
  }

  // Update preview panel
  function updatePreview() {
    // Update user info
    userInfo.name = userNameInput.value.trim();
    userInfo.destination = destinationInput.value.trim();
    userInfo.contactDetails = contactDetailsInput.value.trim();

    // Change template class
    resumePreview.className = 'resume-preview ' + templateSelect.value;

    // Clear preview first
    resumePreview.innerHTML = '';

    // Add personal info
    if (userInfo.name) {
      const h1 = document.createElement('h1');
      h1.className = 'resume-heading';
      h1.textContent = userInfo.name;
      resumePreview.appendChild(h1);
    }
    if (userInfo.destination) {
      const h2 = document.createElement('h2');
      h2.className = 'resume-subheading';
      h2.textContent = userInfo.destination;
      resumePreview.appendChild(h2);
    }
    if (userInfo.contactDetails) {
      const p = document.createElement('p');
      p.className = 'resume-contact';
      p.innerText = userInfo.contactDetails;
      resumePreview.appendChild(p);
    }

    // Show profile photo
    renderProfilePhoto();

    // Add sections and entries
    for (const [section, entries] of Object.entries(resumeData)) {
      const secDiv = document.createElement('div');
      secDiv.className = 'section';
      const heading = document.createElement('h3');
      heading.textContent = section;
      secDiv.appendChild(heading);
      entries.forEach(entry => {
        const entryDiv = document.createElement('div');
        entryDiv.className = 'entry-content';
        entryDiv.innerHTML = entry.content;
        secDiv.appendChild(entryDiv);
      });
      resumePreview.appendChild(secDiv);
    }

    // If no entries yet
    if (!userInfo.name && Object.keys(resumeData).length === 0) {
      resumePreview.innerHTML = '<p><em>Add data to see preview...</em></p>';
    }
  }

  // Save all data to localStorage
  function saveToLocalStorage() {
    const dataToSave = {
      resumeData,
      userInfo,
      profilePhotoDataURL,
      photoPosition
    };
    localStorage.setItem('resumeBuilderData', JSON.stringify(dataToSave));
  }

  // Load data from localStorage
  function loadFromLocalStorage() {
    let saved = localStorage.getItem('resumeBuilderData');
    if (!saved) return;
    try {
      let data = JSON.parse(saved);
      if (data.resumeData) resumeData = data.resumeData;
      if (data.userInfo) {
        userInfo = data.userInfo;
        userNameInput.value = userInfo.name || '';
        destinationInput.value = userInfo.destination || '';
        contactDetailsInput.value = userInfo.contactDetails || '';
      }
      if (data.profilePhotoDataURL) {
        profilePhotoDataURL = data.profilePhotoDataURL;
        photoPosition = data.photoPosition || { top: 20, right: 20 };
        renderProfilePhoto();
      }
    } catch(e) {
      console.warn('Failed to load saved data', e);
    }
  }

  // Clear all data
  function clearAllData() {
    if (!confirm('Clear all resume data? This cannot be undone.')) return;
    resumeData = {};
    userInfo = { name:'', destination:'', contactDetails:'' };
    profilePhotoDataURL = null;
    photoPosition = { top: 20, right: 20 };
    editIndex = null;
    userNameInput.value = '';
    destinationInput.value = '';
    contactDetailsInput.value = '';
    clearEntryForm();
    saveToLocalStorage();
    renderEntryList();
    updatePreview();
    if (profilePhotoElement) {
      profilePhotoElement.remove();
      profilePhotoElement = null;
    }
  }

  // Export to Word
  function exportToWord() {
    const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
      "xmlns:w='urn:schemas-microsoft-com:office:word' "+
      "xmlns='http://www.w3.org/TR/REC-html40'>"+
      "<head><meta charset='utf-8'><title>Resume</title></head><body>";
    const footer = "</body></html>";
    const content = resumePreview.innerHTML;
    const html = header + content + footer;
    const converted = window.htmlDocx.asBlob(html, {orientation: 'portrait'});
    saveAs(converted, "resume.docx");
  }

  // Export to PDF (simple using html2canvas + jsPDF)
  async function exportToPDF() {
  const pageSize = pdfPageSize.value === 'letter' ? [612, 792] : [595, 842]; // Width x Height in points
  const margin = parseInt(pdfMargin.value) || 20;
  const pdfWidth = pageSize[0] - 2 * margin;
  const pdfHeight = pageSize[1] - 2 * margin;

  const canvas = await html2canvas(resumePreview, {
    scale: 2,
    useCORS: true,
    allowTaint: true,
    backgroundColor: '#fff',
    scrollY: -window.scrollY
  });

  const imgData = canvas.toDataURL('image/png');
  const imgWidth = canvas.width;
  const imgHeight = canvas.height;

  const pdf = new jspdf.jsPDF({
    unit: 'pt',
    format: pageSize,
    compress: true
  });

  const ratio = pdfWidth / imgWidth;
  const scaledHeight = imgHeight * ratio;

  let position = 0;
  let remainingHeight = scaledHeight;

  while (remainingHeight > 0) {
    const sourceY = (position / ratio);
    const canvasPart = document.createElement('canvas');
    canvasPart.width = imgWidth;
    canvasPart.height = Math.min(imgHeight - sourceY, pdfHeight / ratio);

    const ctx = canvasPart.getContext('2d');
    ctx.drawImage(canvas, 0, sourceY, imgWidth, canvasPart.height, 0, 0, imgWidth, canvasPart.height);

    const partDataUrl = canvasPart.toDataURL('image/png');
    const partHeight = canvasPart.height * ratio;

    pdf.addImage(partDataUrl, 'PNG', margin, margin, pdfWidth, partHeight);

    remainingHeight -= pdfHeight;
    position += pdfHeight;

    if (remainingHeight > 0) {
      pdf.addPage();
    }
  }

  pdf.save('resume.pdf');
}

  // Attach all event listeners
  function attachEventListeners() {
    // Inputs updating preview live
    [userNameInput, destinationInput, contactDetailsInput].forEach(el => {
      el.addEventListener('input', () => {
        updatePreview();
        saveToLocalStorage();
      });
    });
    // Template change updates preview
    templateSelect.addEventListener('change', () => {
      updatePreview();
      saveToLocalStorage();
    });
    // Section dropdown clears custom input if changed
    sectionSelect.addEventListener('change', () => {
      customSectionInput.value = '';
    });
    // Custom input clears dropdown if typed
    customSectionInput.addEventListener('input', () => {
      if (customSectionInput.value.trim()) sectionSelect.value = '';
    });
    // Entry content change saves undo stack
    entryContent.addEventListener('input', () => {
      saveToUndoStack();
    });
    // Profile photo upload
    profilePhotoInput.addEventListener('change', handlePhotoUpload);

    // Drag photo inside preview
    photoContainer.addEventListener('mousedown', e => {
      if (e.target === profilePhotoElement) {
        isDraggingPhoto = true;
        dragOffset.x = e.clientX - profilePhotoElement.offsetLeft;
        dragOffset.y = e.clientY - profilePhotoElement.offsetTop;
        profilePhotoElement.style.cursor = 'grabbing';
      }
    });
    window.addEventListener('mouseup', () => {
      if (isDraggingPhoto) {
        isDraggingPhoto = false;
        if (profilePhotoElement) profilePhotoElement.style.cursor = 'grab';
        saveToLocalStorage();
      }
    });
    window.addEventListener('mousemove', e => {
      if (isDraggingPhoto && profilePhotoElement) {
        let newX = e.clientX - dragOffset.x;
        let newY = e.clientY - dragOffset.y;
        // Boundaries inside photoContainer
        const rect = photoContainer.getBoundingClientRect();
        const photoWidth = profilePhotoElement.offsetWidth;
        const photoHeight = profilePhotoElement.offsetHeight;

        newX = Math.min(rect.width - photoWidth, Math.max(0, newX));
        newY = Math.min(rect.height - photoHeight, Math.max(0, newY));

        profilePhotoElement.style.left = newX + 'px';
        profilePhotoElement.style.top = newY + 'px';

        // Save position relative to container
        photoPosition.top = newY;
        photoPosition.right = rect.width - photoWidth - newX;
      }
    });
  }

  // Handle profile photo upload
  function handlePhotoUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) {
      alert('Please upload an image file');
      return;
    }
    const reader = new FileReader();
    reader.onload = function(event) {
      profilePhotoDataURL = event.target.result;
      photoPosition = { top: 20, right: 20 };
      renderProfilePhoto();
      saveToLocalStorage();
    }
    reader.readAsDataURL(file);
  }

  // Render profile photo in preview with drag support
  function renderProfilePhoto() {
  if (!profilePhotoDataURL) return;

  // Remove existing photo if any
  const existingPhoto = resumePreview.querySelector('.profile-photo');
  if (existingPhoto) existingPhoto.remove();

  const img = document.createElement('img');
  img.src = profilePhotoDataURL;
  img.className = 'profile-photo';
  img.style.position = 'absolute';
  img.style.width = '100px';
  img.style.height = '100px';
  img.style.objectFit = 'cover';
  img.style.borderRadius = '50%';
  img.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
  img.style.top = photoPosition.top + 'px';
  img.style.left = `calc(100% - ${photoPosition.right + 100}px)`; // adjust for photo width

  resumePreview.appendChild(img);
}


</script>
<style>
  @media print {
    .resume-preview .section {
      page-break-inside: avoid;
    }
  }
  .resume-preview {
  position: relative;
}

.profile-photo {
  z-index: 1;
}

</style>

</body>
</html>
